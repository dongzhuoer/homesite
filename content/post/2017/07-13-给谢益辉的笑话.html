---
title: 给谢益辉的笑话
author: Zhuoer Dong
date: '2017-07-13'
slug: 给谢益辉的笑话
categories: 2017
tags: []
authors: []
---

<script src="07-13-给谢益辉的笑话_files/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#废话"><span class="toc-section-number">1</span> 废话</a></li>
<li><a href="#引言"><span class="toc-section-number">2</span> 引言</a></li>
<li><a href="#开端"><span class="toc-section-number">3</span> 开端</a></li>
<li><a href="#发展"><span class="toc-section-number">4</span> 发展</a></li>
<li><a href="#高潮"><span class="toc-section-number">5</span> 高潮</a></li>
<li><a href="#结局"><span class="toc-section-number">6</span> 结局</a></li>
<li><a href="#尾声"><span class="toc-section-number">7</span> 尾声</a></li>
</ul>
</div>

<blockquote>
<p>从 knitr 开始逐渐了解了谢益辉，后来翻了他的博客，发现这个人很对我的胃口。看见他在一篇博文中写过，想让他快速解决问题可以附个笑话。暑假没事干时瞎鼓捣 bookdown，花了好多时间之后发现结果很有戏剧性，就给他写了一封邮件。后来还来来往往写了几封，就不转移到博客了，太花时间（这一篇是以前已经写好了的，只需要整理一下）。</p>
</blockquote>
<div id="废话" class="section level1" number="1">
<h1><span class="header-section-number">1</span> 废话</h1>
<p>我的英文不是很好，而且你也应该看得懂中文，所以我就直接写中文了，反正主要目的是给你讲个笑话。</p>
<p>我叫董卓尔，是南开大学的一名本科生，或者说是 <em>R语言高级菜鸟</em>（本来我想自封中级用户的，但不久前在 Stack Overflow 遭受了一次<a href="https://stackoverflow.com/questions/45016841/how-do-you-remove-un-named-columns-with-a-vector/45017445#45017445">打击</a>，就老实地做菜鸟了）。你可以叫我卓尔。</p>
<p>在学习R语言的过程中不可避免地接触到了你（<strong>bookdown</strong> 真的超棒），并且也在 GitHub 上与你有过多次交流 （我的用户名是<code>dongzhuoer</code>）。</p>
<p>这次给你发邮件是为了给你讲个笑话, 我觉得几乎不会重复，因为这个笑话是昨天刚发生的真人真事。本来事件应该像一般的 bug 一样，开一个 Issue 就好了。但是最后发生了出人意料的转折，以至于我觉得这成了一个值得发给你的笑话。</p>
</div>
<div id="引言" class="section level1" number="2">
<h1><span class="header-section-number">2</span> 引言</h1>
<p>招呼打完了，开始说正事。</p>
<p>起源是我觉得你的《R语言忍者秘笈》写的蛮好，但 <a href="https://bookdown.org">bookdown 网站</a>实在太慢，就 clone 了 GtiHub 源代码库到本地来 build。然而</p>
<pre><code>R version 3.4.1 (2017-06-30) -- &quot;Single Candle&quot;
Copyright (C) 2017 The R Foundation for Statistical Computing

...

Type &#39;q()&#39; to quit R.

Error in yaml::yaml.load(string, ...) : 
  Reader error: invalid trailing UTF-8 octet: #EF at 9</code></pre>
<p>刚打开 R project 就报错，还能不能愉快地玩耍了？</p>
</div>
<div id="开端" class="section level1" number="3">
<h1><span class="header-section-number">3</span> 开端</h1>
<p>不过查错是忍者的基本技能，一番鼓捣之后，发现问题出在这：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>yaml<span class="sc">::</span><span class="fu">yaml.load_file</span>(<span class="st">&#39;_bookdown.yml&#39;</span>)</span></code></pre></div>
<pre><code>Error in yaml.load(paste(readLines(input, encoding = &quot;UTF-8&quot;), collapse = &quot;\n&quot;),  : 
  Reader error: invalid leading UTF-8 octet: #B5 at 39</code></pre>
<p>废话少说，开始调试：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">debug</span>(yaml<span class="sc">::</span>yaml.load_file)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>yaml<span class="sc">::</span><span class="fu">yaml.load_file</span>(<span class="st">&#39;_bookdown.yml&#39;</span>)</span></code></pre></div>
<pre><code>debugging in: yaml::yaml.load_file(&quot;_bookdown.yml&quot;)
debug: {
    yaml.load(paste(readLines(input, encoding = &quot;UTF-8&quot;), collapse = &quot;\\n&quot;), 
        ...)
}</code></pre>
<p>我觉得是 <code>readLines()</code> 的问题：</p>
<pre><code>Browse[2]&gt; readLines(input, encoding = &quot;UTF-8&quot;)
[1] &quot;book_filename: r-ninja&quot;                  &quot;chapter_name: [\&quot;�\xda\&quot;, \&quot;\xd5\xc2\&quot;]&quot;
[3] &quot;repo: https://github.com/yihui/r-ninja/&quot; &quot;output_dir: _book&quot;                      
[5] &quot;clean: [packages.bib, r-ninja.bbl]&quot;  </code></pre>
<p>果然不正常，看看 <code>readr::read_lines()</code> 怎么样：</p>
<pre><code>Browse[2]&gt; readr::read_lines(input)
[1] &quot;book_filename: r-ninja&quot;                  &quot;chapter_name: [\&quot;第\&quot;, \&quot;章\&quot;]&quot;         
[3] &quot;repo: https://github.com/yihui/r-ninja/&quot; &quot;output_dir: _book&quot;                      
[5] &quot;clean: [packages.bib, r-ninja.bbl]&quot; </code></pre>
<p>这个好，看来要改 <strong>yaml</strong> 源代码或者向作者报告了。</p>
</div>
<div id="发展" class="section level1" number="4">
<h1><span class="header-section-number">4</span> 发展</h1>
<p>然而在 <code>viking/r-yaml</code> 写 Issue 时，我又有了新发现：</p>
<pre><code>Browse[2]&gt; readLines(input)
[1] &quot;book_filename: r-ninja&quot;                  &quot;chapter_name: [\&quot;第\&quot;, \&quot;章\&quot;]&quot;         
[3] &quot;repo: https://github.com/yihui/r-ninja/&quot; &quot;output_dir: gitbook&quot;                    
[5] &quot;clean: [packages.bib, r-ninja.bbl]&quot; </code></pre>
<p>这可真是太神奇了，怎么不加 <code>encoding = "UTF-8"</code> 反而好了？</p>
<p>继续写 Issue，把上面的情况也加上去。写着写着，我突然想到另一件与 <code>"UTF-8"</code> 有关的事，之前我在 <code>.Rprofile</code> 加了这句话：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span></code></pre></div>
<p>也许是这句话惹的祸？果然，去掉之后（<code>encoding</code> 取默认值<code>"native.enc"</code>），就一切正常了。</p>
</div>
<div id="高潮" class="section level1" number="5">
<h1><span class="header-section-number">5</span> 高潮</h1>
<p>华丽丽的分割线。</p>
<p>到此为止，都是一个正常的Issue，接下来才是笑话的重点。</p>
<p>由于刚学会 Git，可以从一个新的高度来使用 GitHub（之前连 clone 都不会，只会下载 <code>*.zip</code>），我暂时还处于一种比较新鲜的状态。于是找到 <strong>yaml</strong> 的<a href="https://github.com/viking/r-yaml/">源代码库</a>之后，我没事翻了一下 contributors
<img src="https://user-images.githubusercontent.com/15871952/28147684-d3d48e82-67b4-11e7-9ddf-991d2d4787ba.PNG" /></p>
<p>哇，有 hadley 大人耶，还有益辉。按你的博客说的，我就不加扩展名（老师 、大牛等）了。</p>
<p>然后，我更加没事地翻了一下你的 commit
<img src="https://user-images.githubusercontent.com/15871952/28147749-3670bdfe-67b5-11e7-8eee-ae05bd070c99.PNG" /></p>
<p>结果闪瞎我的狗眼啊！！！
<img src="https://user-images.githubusercontent.com/15871952/28147874-ee71a760-67b5-11e7-9f21-3bc5e753d417.PNG" /></p>
<p>这句话居然是你加的！含有中文的 <code>.yml</code> 文件也是你写的！这是搬起石头砸自己的脚吗？可为什么受到伤害的是我啊！</p>
<p>我觉得更贴切的比喻应该是这样的：你先挖了一个大坑（居然往<code>.yml</code>文件塞中文，定时炸弹啊），为了不让路人掉进去，你很负责地在周围设置了护栏（在 <code>yaml::yaml.load_file</code> 中加入 <code>encoding = "UTF-8"</code>）。然而人算不如天算，还是留了一个缺口，最后我就很开心地偏偏对着这个缺口冲过去了（<code>options(encoding = "UTF-8")</code>）。</p>
</div>
<div id="结局" class="section level1" number="6">
<h1><span class="header-section-number">6</span> 结局</h1>
<p>不管怎么说，我还是花了一小时认真写好 Issue，希望能被 Google 收录。这样以后再有人遇到同样的问题时，可以查到很有用的参考资料。</p>
<p>最后，希望你不要觉得这是一个冷笑话吧。</p>
</div>
<div id="尾声" class="section level1" number="7">
<h1><span class="header-section-number">7</span> 尾声</h1>
<p>有空麻烦看一下 <strong>bookdown</strong> 的这个 <a href="https://github.com/rstudio/bookdown/issues/419">Issue</a>。虽然我也做过<a href="http://2016.igem.org/Team:NKU_China">网站</a>，HTML、CSS、Javascript 也都会用，但是我觉得还是开发者解决起来更高效一些。</p>
</div>
