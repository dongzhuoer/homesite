---
title: 'machine learning in R: using random forest as an example'
author: Zhuoer Dong
date: '2018-11-14'
output: 
    blogdown::html_page:
        df_print: paged    
slug: r-machine-learning-random-forest-example
categories: 2018
tags: []
authors: []
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/pagedtable/js/pagedtable.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#preparation"><span class="toc-section-number">1</span> preparation</a></li>
<li><a href="#generate-data-set"><span class="toc-section-number">2</span> generate data set</a></li>
<li><a href="#split-data-set"><span class="toc-section-number">3</span> Split data set</a></li>
<li><a href="#build-the-model"><span class="toc-section-number">4</span> Build the model</a></li>
<li><a href="#evaluate-the-model---basics"><span class="toc-section-number">5</span> Evaluate the model - basics</a></li>
<li><a href="#evaluate-the-model---advanced"><span class="toc-section-number">6</span> Evaluate the model - advanced</a></li>
<li><a href="#tips-and-more"><span class="toc-section-number">7</span> Tips and more</a></li>
</ul>
</div>

<p>We will introduce the basic ideas of machine learning in R, use random forest model as an example.</p>
<div id="preparation" class="section level1" number="1">
<h1><span class="header-section-number">1</span> preparation</h1>
<p>we need to install the following packages <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install needed R packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">update_packages</span>(<span class="fu">c</span>(<span class="st">&#39;magrittr&#39;</span>, <span class="st">&#39;dplyr&#39;</span>, <span class="st">&#39;randomForest&#39;</span>, <span class="st">&#39;ROCR&#39;</span>, <span class="st">&#39;GGally&#39;</span>), <span class="at">upgrade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To avoid conflict of function name, in the following code, I will try me best to use <code>pkg::fun()</code> instead of <code>library(pkg)</code>. But <strong>magrittr</strong> is special, we have to <code>library()</code> it.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<p>Before we start, let set the random seed to make our results reproducible:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>) </span></code></pre></div>
</div>
<div id="generate-data-set" class="section level1" number="2">
<h1><span class="header-section-number">2</span> generate data set</h1>
<p>We use one of R’s built-in data set, <code>iris</code>, Edgar Anderson’s Iris Data set.</p>
<p>The original data set contains observations for four features (sepal length and width, and petal length and width — all in cm) of 150 flowers of three species (each 50).</p>
<p>To make things simple, here we only choose two species, <code>versicolor</code> and <code>virginica</code>. <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Species <span class="sc">!=</span> <span class="st">&#39;setosa&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">factor</span>(Species))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Sepal.Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sepal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Petal.Length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Petal.Width"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Species"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"7.0","2":"3.2","3":"4.7","4":"1.4","5":"versicolor"},{"1":"6.4","2":"3.2","3":"4.5","4":"1.5","5":"versicolor"},{"1":"6.9","2":"3.1","3":"4.9","4":"1.5","5":"versicolor"},{"1":"5.5","2":"2.3","3":"4.0","4":"1.3","5":"versicolor"},{"1":"6.5","2":"2.8","3":"4.6","4":"1.5","5":"versicolor"},{"1":"5.7","2":"2.8","3":"4.5","4":"1.3","5":"versicolor"},{"1":"6.3","2":"3.3","3":"4.7","4":"1.6","5":"versicolor"},{"1":"4.9","2":"2.4","3":"3.3","4":"1.0","5":"versicolor"},{"1":"6.6","2":"2.9","3":"4.6","4":"1.3","5":"versicolor"},{"1":"5.2","2":"2.7","3":"3.9","4":"1.4","5":"versicolor"},{"1":"5.0","2":"2.0","3":"3.5","4":"1.0","5":"versicolor"},{"1":"5.9","2":"3.0","3":"4.2","4":"1.5","5":"versicolor"},{"1":"6.0","2":"2.2","3":"4.0","4":"1.0","5":"versicolor"},{"1":"6.1","2":"2.9","3":"4.7","4":"1.4","5":"versicolor"},{"1":"5.6","2":"2.9","3":"3.6","4":"1.3","5":"versicolor"},{"1":"6.7","2":"3.1","3":"4.4","4":"1.4","5":"versicolor"},{"1":"5.6","2":"3.0","3":"4.5","4":"1.5","5":"versicolor"},{"1":"5.8","2":"2.7","3":"4.1","4":"1.0","5":"versicolor"},{"1":"6.2","2":"2.2","3":"4.5","4":"1.5","5":"versicolor"},{"1":"5.6","2":"2.5","3":"3.9","4":"1.1","5":"versicolor"},{"1":"5.9","2":"3.2","3":"4.8","4":"1.8","5":"versicolor"},{"1":"6.1","2":"2.8","3":"4.0","4":"1.3","5":"versicolor"},{"1":"6.3","2":"2.5","3":"4.9","4":"1.5","5":"versicolor"},{"1":"6.1","2":"2.8","3":"4.7","4":"1.2","5":"versicolor"},{"1":"6.4","2":"2.9","3":"4.3","4":"1.3","5":"versicolor"},{"1":"6.6","2":"3.0","3":"4.4","4":"1.4","5":"versicolor"},{"1":"6.8","2":"2.8","3":"4.8","4":"1.4","5":"versicolor"},{"1":"6.7","2":"3.0","3":"5.0","4":"1.7","5":"versicolor"},{"1":"6.0","2":"2.9","3":"4.5","4":"1.5","5":"versicolor"},{"1":"5.7","2":"2.6","3":"3.5","4":"1.0","5":"versicolor"},{"1":"5.5","2":"2.4","3":"3.8","4":"1.1","5":"versicolor"},{"1":"5.5","2":"2.4","3":"3.7","4":"1.0","5":"versicolor"},{"1":"5.8","2":"2.7","3":"3.9","4":"1.2","5":"versicolor"},{"1":"6.0","2":"2.7","3":"5.1","4":"1.6","5":"versicolor"},{"1":"5.4","2":"3.0","3":"4.5","4":"1.5","5":"versicolor"},{"1":"6.0","2":"3.4","3":"4.5","4":"1.6","5":"versicolor"},{"1":"6.7","2":"3.1","3":"4.7","4":"1.5","5":"versicolor"},{"1":"6.3","2":"2.3","3":"4.4","4":"1.3","5":"versicolor"},{"1":"5.6","2":"3.0","3":"4.1","4":"1.3","5":"versicolor"},{"1":"5.5","2":"2.5","3":"4.0","4":"1.3","5":"versicolor"},{"1":"5.5","2":"2.6","3":"4.4","4":"1.2","5":"versicolor"},{"1":"6.1","2":"3.0","3":"4.6","4":"1.4","5":"versicolor"},{"1":"5.8","2":"2.6","3":"4.0","4":"1.2","5":"versicolor"},{"1":"5.0","2":"2.3","3":"3.3","4":"1.0","5":"versicolor"},{"1":"5.6","2":"2.7","3":"4.2","4":"1.3","5":"versicolor"},{"1":"5.7","2":"3.0","3":"4.2","4":"1.2","5":"versicolor"},{"1":"5.7","2":"2.9","3":"4.2","4":"1.3","5":"versicolor"},{"1":"6.2","2":"2.9","3":"4.3","4":"1.3","5":"versicolor"},{"1":"5.1","2":"2.5","3":"3.0","4":"1.1","5":"versicolor"},{"1":"5.7","2":"2.8","3":"4.1","4":"1.3","5":"versicolor"},{"1":"6.3","2":"3.3","3":"6.0","4":"2.5","5":"virginica"},{"1":"5.8","2":"2.7","3":"5.1","4":"1.9","5":"virginica"},{"1":"7.1","2":"3.0","3":"5.9","4":"2.1","5":"virginica"},{"1":"6.3","2":"2.9","3":"5.6","4":"1.8","5":"virginica"},{"1":"6.5","2":"3.0","3":"5.8","4":"2.2","5":"virginica"},{"1":"7.6","2":"3.0","3":"6.6","4":"2.1","5":"virginica"},{"1":"4.9","2":"2.5","3":"4.5","4":"1.7","5":"virginica"},{"1":"7.3","2":"2.9","3":"6.3","4":"1.8","5":"virginica"},{"1":"6.7","2":"2.5","3":"5.8","4":"1.8","5":"virginica"},{"1":"7.2","2":"3.6","3":"6.1","4":"2.5","5":"virginica"},{"1":"6.5","2":"3.2","3":"5.1","4":"2.0","5":"virginica"},{"1":"6.4","2":"2.7","3":"5.3","4":"1.9","5":"virginica"},{"1":"6.8","2":"3.0","3":"5.5","4":"2.1","5":"virginica"},{"1":"5.7","2":"2.5","3":"5.0","4":"2.0","5":"virginica"},{"1":"5.8","2":"2.8","3":"5.1","4":"2.4","5":"virginica"},{"1":"6.4","2":"3.2","3":"5.3","4":"2.3","5":"virginica"},{"1":"6.5","2":"3.0","3":"5.5","4":"1.8","5":"virginica"},{"1":"7.7","2":"3.8","3":"6.7","4":"2.2","5":"virginica"},{"1":"7.7","2":"2.6","3":"6.9","4":"2.3","5":"virginica"},{"1":"6.0","2":"2.2","3":"5.0","4":"1.5","5":"virginica"},{"1":"6.9","2":"3.2","3":"5.7","4":"2.3","5":"virginica"},{"1":"5.6","2":"2.8","3":"4.9","4":"2.0","5":"virginica"},{"1":"7.7","2":"2.8","3":"6.7","4":"2.0","5":"virginica"},{"1":"6.3","2":"2.7","3":"4.9","4":"1.8","5":"virginica"},{"1":"6.7","2":"3.3","3":"5.7","4":"2.1","5":"virginica"},{"1":"7.2","2":"3.2","3":"6.0","4":"1.8","5":"virginica"},{"1":"6.2","2":"2.8","3":"4.8","4":"1.8","5":"virginica"},{"1":"6.1","2":"3.0","3":"4.9","4":"1.8","5":"virginica"},{"1":"6.4","2":"2.8","3":"5.6","4":"2.1","5":"virginica"},{"1":"7.2","2":"3.0","3":"5.8","4":"1.6","5":"virginica"},{"1":"7.4","2":"2.8","3":"6.1","4":"1.9","5":"virginica"},{"1":"7.9","2":"3.8","3":"6.4","4":"2.0","5":"virginica"},{"1":"6.4","2":"2.8","3":"5.6","4":"2.2","5":"virginica"},{"1":"6.3","2":"2.8","3":"5.1","4":"1.5","5":"virginica"},{"1":"6.1","2":"2.6","3":"5.6","4":"1.4","5":"virginica"},{"1":"7.7","2":"3.0","3":"6.1","4":"2.3","5":"virginica"},{"1":"6.3","2":"3.4","3":"5.6","4":"2.4","5":"virginica"},{"1":"6.4","2":"3.1","3":"5.5","4":"1.8","5":"virginica"},{"1":"6.0","2":"3.0","3":"4.8","4":"1.8","5":"virginica"},{"1":"6.9","2":"3.1","3":"5.4","4":"2.1","5":"virginica"},{"1":"6.7","2":"3.1","3":"5.6","4":"2.4","5":"virginica"},{"1":"6.9","2":"3.1","3":"5.1","4":"2.3","5":"virginica"},{"1":"5.8","2":"2.7","3":"5.1","4":"1.9","5":"virginica"},{"1":"6.8","2":"3.2","3":"5.9","4":"2.3","5":"virginica"},{"1":"6.7","2":"3.3","3":"5.7","4":"2.5","5":"virginica"},{"1":"6.7","2":"3.0","3":"5.2","4":"2.3","5":"virginica"},{"1":"6.3","2":"2.5","3":"5.0","4":"1.9","5":"virginica"},{"1":"6.5","2":"3.0","3":"5.2","4":"2.0","5":"virginica"},{"1":"6.2","2":"3.4","3":"5.4","4":"2.3","5":"virginica"},{"1":"5.9","2":"3.0","3":"5.1","4":"1.8","5":"virginica"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<blockquote>
<p>Remember to drops unused level using <code>factor()</code>, otherwise <code>randomForest::randomForest()</code> would complain. <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
</blockquote>
<p>Optional: before we build the model, we may explore the correlation between features <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
</div>
<div id="split-data-set" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Split data set</h1>
<p>Before we build the model, we need to split the data set into training set and testing set. So we can train our model using data in training set, and evalute the model using data in testing set.</p>
<p>Here we randomly assigns 80 percent samples to the traing set, and the left 20 percent to the testing set <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nrow_training <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(df) <span class="sc">*</span> <span class="fl">0.8</span>)  <span class="co"># Calculate the size of training sets</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>indexes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), nrow_training)  <span class="co"># these rows will be select for training</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> df[indexes, ] </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> df[<span class="sc">-</span>indexes, ]</span></code></pre></div>
<p>You may want to have a look at the result <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>.</p>
</div>
<div id="build-the-model" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Build the model</h1>
<p>Then we can build a random forest model <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rf_classifier <span class="ot">=</span> randomForest<span class="sc">::</span><span class="fu">randomForest</span>(Species <span class="sc">~</span> ., training)</span></code></pre></div>
<p>You can feed <code>randomForest::randomForest()</code> two arguments:</p>
<ul>
<li>a <code>formula</code>: here <code>Species</code> is the response variable, <code>.</code> tells that all other variables are features</li>
<li>a data frame to train the model</li>
</ul>
</div>
<div id="evaluate-the-model---basics" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Evaluate the model - basics</h1>
<p>After we build the model, the fundamental use is to make prediction. That’s exactly where the testing set comes in handy:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>predicted_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_classifier, testing[, <span class="sc">-</span><span class="fu">ncol</span>(testing)])</span></code></pre></div>
<p><code>predict()</code> needs two arguments: the model and a data frame of <em>features</em> <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
<p>We can compare the predicted class with real class <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>real_class <span class="ot">=</span> testing[[<span class="fu">ncol</span>(testing)]]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(predicted_class, real_class) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">correct =</span> predicted_class <span class="sc">==</span> real_class)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["predicted_class"],"name":[1],"type":["fct"],"align":["left"]},{"label":["real_class"],"name":[2],"type":["fct"],"align":["left"]},{"label":["correct"],"name":[3],"type":["lgl"],"align":["right"]}],"data":[{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"versicolor","2":"versicolor","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"},{"1":"virginica","2":"virginica","3":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>To quantify the performance of our model, we can construct a confusion matrix</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we define &#39;versicolor&#39; as positive class</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> <span class="fu">sum</span>((predicted_class <span class="sc">==</span> <span class="st">&#39;versicolor&#39;</span>) <span class="sc">&amp;</span> (real_class <span class="sc">==</span> <span class="st">&#39;versicolor&#39;</span>)) <span class="co">#true positive</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>FP <span class="ot">&lt;-</span> <span class="fu">sum</span>((predicted_class <span class="sc">==</span> <span class="st">&#39;versicolor&#39;</span>) <span class="sc">&amp;</span> (real_class <span class="sc">!=</span> <span class="st">&#39;versicolor&#39;</span>)) <span class="co">#false positive</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>FN <span class="ot">&lt;-</span> <span class="fu">sum</span>((predicted_class <span class="sc">!=</span> <span class="st">&#39;versicolor&#39;</span>) <span class="sc">&amp;</span> (real_class <span class="sc">==</span> <span class="st">&#39;versicolor&#39;</span>)) <span class="co">#false negative </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>TN <span class="ot">&lt;-</span> <span class="fu">sum</span>((predicted_class <span class="sc">!=</span> <span class="st">&#39;versicolor&#39;</span>) <span class="sc">&amp;</span> (real_class <span class="sc">!=</span> <span class="st">&#39;versicolor&#39;</span>)) <span class="co">#true negative </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="st">&#39;&#39;</span>, <span class="sc">~</span><span class="st">&#39;Predicted versicolor&#39;</span>, <span class="sc">~</span><span class="st">&#39;Predicted virginica&#39;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;True versicolor&#39;</span>, TP, FP,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;True virginica&#39;</span>,  FN, TN</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":[1],"type":["chr"],"align":["left"]},{"label":["Predicted versicolor"],"name":[2],"type":["int"],"align":["right"]},{"label":["Predicted virginica"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"True versicolor","2":"11","3":"0"},{"1":"True virginica","2":"0","3":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>and compute common evaluation indicators</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>indicator, <span class="sc">~</span>value,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sensitivity&#39;</span>, TP<span class="sc">/</span>(TP <span class="sc">+</span> FN),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;specificity&#39;</span>, TN<span class="sc">/</span>(TN <span class="sc">+</span> FP),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;accuracy&#39;</span>, (TP <span class="sc">+</span> TN)<span class="sc">/</span>(TP <span class="sc">+</span> TN <span class="sc">+</span> FP <span class="sc">+</span> FN)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["indicator"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"sensitivity","2":"1"},{"1":"specificity","2":"1"},{"1":"accuracy","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="evaluate-the-model---advanced" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Evaluate the model - advanced</h1>
<p>Except for definite class, the model can also tell us the probability that a given sample belongs to each class:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>probability <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_classifier, testing[, <span class="sc">-</span><span class="fu">ncol</span>(testing)], <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>probability <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["versicolor"],"name":[1],"type":["matrix"],"align":["right"]},{"label":["virginica"],"name":[2],"type":["matrix"],"align":["right"]}],"data":[{"1":"0.754","2":"0.246"},{"1":"0.998","2":"0.002"},{"1":"0.962","2":"0.038"},{"1":"0.768","2":"0.232"},{"1":"0.980","2":"0.020"},{"1":"1.000","2":"0.000"},{"1":"0.998","2":"0.002"},{"1":"0.794","2":"0.206"},{"1":"0.998","2":"0.002"},{"1":"1.000","2":"0.000"},{"1":"0.996","2":"0.004"},{"1":"0.000","2":"1.000"},{"1":"0.000","2":"1.000"},{"1":"0.004","2":"0.996"},{"1":"0.000","2":"1.000"},{"1":"0.036","2":"0.964"},{"1":"0.094","2":"0.906"},{"1":"0.000","2":"1.000"},{"1":"0.000","2":"1.000"},{"1":"0.002","2":"0.998"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>For example, 0.998 in the second row means the probability of the second sample in the testing set belonging to <code>versicolor</code>.</p>
<p>Actually, the predicted class we see above is determined by judging whether the probability is greater than a given cutoff (the default is 0.5):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>((probability[ , <span class="dv">1</span>, <span class="at">drop =</span> T] <span class="sc">&gt;</span> <span class="fl">0.5</span>) <span class="sc">==</span> (predicted_class <span class="sc">==</span> <span class="st">&#39;versicolor&#39;</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
<p>Using different curoff, we can draw a ROC curve <a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> testing[[<span class="fu">ncol</span>(testing)]] <span class="sc">%&gt;%</span> {. <span class="sc">==</span>  <span class="st">&#39;versicolor&#39;</span>} <span class="sc">%&gt;%</span> as.integer</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(probability[, <span class="dv">1</span>], label)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in loadNamespace(name): there is no package called &#39;ROCR&#39;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>prediction <span class="sc">%&gt;%</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(<span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>) <span class="sc">%&gt;%</span> ROCR<span class="sc">::</span><span class="fu">plot</span>(<span class="at">main =</span> <span class="st">&quot;ROC Curve&quot;</span>) </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in loadNamespace(name): there is no package called &#39;ROCR&#39;</span></span></code></pre></div>
<p>and cauculate the AUC (area under the curve)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ROCR<span class="sc">::</span><span class="fu">performance</span>(prediction, <span class="st">&#39;auc&#39;</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in loadNamespace(name): there is no package called &#39;ROCR&#39;</span></span></code></pre></div>
</div>
<div id="tips-and-more" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Tips and more</h1>
<p>If you want to see Importance of each feature</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>randomForest<span class="sc">::</span><span class="fu">randomForest</span>(Species <span class="sc">~</span> ., training, <span class="at">importance =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> randomForest<span class="sc">::</span><span class="fu">varImpPlot</span>()</span></code></pre></div>
<p><img src="/post/2018/11-14-r-machine-learning-random-forest-example_files/figure-html/unnamed-chunk-11-1.svg" width="672" /></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><ul>
<li><strong>magrittr</strong> enable one style of writing R code. For why I use that style, please refer to <a href="https://r4ds.had.co.nz/pipes.html#piping-alternatives" class="uri">https://r4ds.had.co.nz/pipes.html#piping-alternatives</a><br />
</li>
<li><strong>dplyr</strong>: manipulate data frame<br />
</li>
<li><strong>randomForest</strong>: build random forest model<br />
</li>
<li><strong>ROCR</strong>: ROC analysis<br />
</li>
<li><strong>GGally</strong>: plot correlation between features</li>
</ul>
<a href="#fnref1" class="footnote-back">↩︎</a></li>
<li id="fn2"><div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Species <span class="sc">!=</span> <span class="st">&#39;setosa&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">factor</span>(Species))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<ul>
<li>The frist line turn <code>iris</code> into a <strong>tibble</strong>, a modern reimagining of the <code>data.frame</code>.</li>
<li>The second line select rows whose species is not <code>setosa</code>, so only <code>versicolor</code> and <code>virginica</code> are left.</li>
<li>The third line drops unused level of the <code>Species</code> factor,</li>
</ul>
<a href="#fnref2" class="footnote-back">↩︎</a></li>
<li id="fn3"><p>This is a little technical:</p>
<p>The orignial Species contains three levels, <code>setosa</code>, <code>versicolor</code> and <code>virginica</code>, each has 50 values.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(Species)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Species"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"setosa","2":"50"},{"1":"versicolor","2":"50"},{"1":"virginica","2":"50"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> .<span class="sc">$</span>Species <span class="sc">%&gt;%</span> levels</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;setosa&quot;     &quot;versicolor&quot; &quot;virginica&quot;</span></span></code></pre></div>
<p>Although we remove all <code>setosa</code> values,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Species <span class="sc">!=</span> <span class="st">&#39;setosa&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df0 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(Species)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Species"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"versicolor","2":"50"},{"1":"virginica","2":"50"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>the <code>setosa</code> level still exists, and now this level contains no values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="sc">%&gt;%</span> .<span class="sc">$</span>Species <span class="sc">%&gt;%</span> levels</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;setosa&quot;     &quot;versicolor&quot; &quot;virginica&quot;</span></span></code></pre></div>
<p>That would cause <code>randomForest::randomForest()</code> to fail.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>randomForest<span class="sc">::</span><span class="fu">randomForest</span>(Species <span class="sc">~</span> ., df0)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in randomForest.default(m, y, ...): Can&#39;t have empty classes in y.</span></span></code></pre></div>
<p>After we call <code>factor()</code>, Species only contains two levels, both do have values.)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="sc">%&gt;%</span> .<span class="sc">$</span>Species <span class="sc">%&gt;%</span> factor <span class="sc">%&gt;%</span> levels</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;versicolor&quot; &quot;virginica&quot;</span></span></code></pre></div>
<a href="#fnref3" class="footnote-back">↩︎</a></li>
<li id="fn4"><div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(df, <span class="at">columns =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> Species))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in loadNamespace(name): there is no package called &#39;GGally&#39;</span></span></code></pre></div>
<a href="#fnref4" class="footnote-back">↩︎</a></li>
<li id="fn5"><div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nrow_training <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(df) <span class="sc">*</span> <span class="fl">0.8</span>)  <span class="co"># Calculate the size of training sets</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>indexes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), nrow_training)  <span class="co"># these rows will be select for training</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> df[indexes, ] </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> df[<span class="sc">-</span>indexes, ]</span></code></pre></div>
<p>The code seems a little complicated, and it require you to be familiar with the R language.</p>
<p>Anyway, I will try to use a simple example to explain the core idea:</p>
<ul>
<li>Image your data contains only 5 rows, then 80 percent is 5 * 0.8 = 4 (i.e. <code>nrow_training</code> is <code>4</code>).<br />
</li>
<li>Image you decide to choose the 1st, 2nd, 3rd and 5th rows for training (i.e. <code>indexes</code> is <code>c(1, 2, 3, 5)</code>)<br />
</li>
<li>Now <code>training</code> contains the 1st, 2nd, 3rd and 5th rows of <code>df</code> (<code>[indexes, ]</code> means to choose these rows)<br />
</li>
<li>And <code>testing</code> contains the 4th row of <code>df</code> (<code>[-indexes, ]</code> means not to choose these rows, so only the 4th row is left)</li>
</ul>
<a href="#fnref5" class="footnote-back">↩︎</a></li>
<li id="fn6"><div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>training</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Sepal.Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sepal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Petal.Length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Petal.Width"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Species"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"6.1","2":"2.9","3":"4.7","4":"1.4","5":"versicolor"},{"1":"7.7","2":"3.8","3":"6.7","4":"2.2","5":"virginica"},{"1":"5.6","2":"3.0","3":"4.1","4":"1.3","5":"versicolor"},{"1":"7.0","2":"3.2","3":"4.7","4":"1.4","5":"versicolor"},{"1":"6.0","2":"2.7","3":"5.1","4":"1.6","5":"versicolor"},{"1":"6.3","2":"3.4","3":"5.6","4":"2.4","5":"virginica"},{"1":"5.8","2":"2.6","3":"4.0","4":"1.2","5":"versicolor"},{"1":"5.9","2":"3.0","3":"5.1","4":"1.8","5":"virginica"},{"1":"7.9","2":"3.8","3":"6.4","4":"2.0","5":"virginica"},{"1":"6.7","2":"2.5","3":"5.8","4":"1.8","5":"virginica"},{"1":"6.3","2":"3.3","3":"6.0","4":"2.5","5":"virginica"},{"1":"6.1","2":"2.6","3":"5.6","4":"1.4","5":"virginica"},{"1":"5.9","2":"3.2","3":"4.8","4":"1.8","5":"versicolor"},{"1":"6.3","2":"2.9","3":"5.6","4":"1.8","5":"virginica"},{"1":"6.3","2":"2.7","3":"4.9","4":"1.8","5":"virginica"},{"1":"6.3","2":"3.3","3":"4.7","4":"1.6","5":"versicolor"},{"1":"7.7","2":"2.8","3":"6.7","4":"2.0","5":"virginica"},{"1":"6.4","2":"2.8","3":"5.6","4":"2.1","5":"virginica"},{"1":"6.7","2":"3.1","3":"4.7","4":"1.5","5":"versicolor"},{"1":"6.9","2":"3.1","3":"5.1","4":"2.3","5":"virginica"},{"1":"6.7","2":"3.0","3":"5.2","4":"2.3","5":"virginica"},{"1":"5.0","2":"2.3","3":"3.3","4":"1.0","5":"versicolor"},{"1":"5.8","2":"2.7","3":"3.9","4":"1.2","5":"versicolor"},{"1":"5.4","2":"3.0","3":"4.5","4":"1.5","5":"versicolor"},{"1":"6.0","2":"2.2","3":"5.0","4":"1.5","5":"virginica"},{"1":"7.7","2":"3.0","3":"6.1","4":"2.3","5":"virginica"},{"1":"6.1","2":"3.0","3":"4.6","4":"1.4","5":"versicolor"},{"1":"6.3","2":"2.3","3":"4.4","4":"1.3","5":"versicolor"},{"1":"5.6","2":"2.5","3":"3.9","4":"1.1","5":"versicolor"},{"1":"6.7","2":"3.0","3":"5.0","4":"1.7","5":"versicolor"},{"1":"5.6","2":"2.8","3":"4.9","4":"2.0","5":"virginica"},{"1":"6.4","2":"2.8","3":"5.6","4":"2.2","5":"virginica"},{"1":"5.5","2":"2.5","3":"4.0","4":"1.3","5":"versicolor"},{"1":"7.7","2":"2.6","3":"6.9","4":"2.3","5":"virginica"},{"1":"6.4","2":"2.9","3":"4.3","4":"1.3","5":"versicolor"},{"1":"6.5","2":"3.0","3":"5.2","4":"2.0","5":"virginica"},{"1":"6.9","2":"3.1","3":"5.4","4":"2.1","5":"virginica"},{"1":"6.7","2":"3.3","3":"5.7","4":"2.1","5":"virginica"},{"1":"5.7","2":"2.8","3":"4.5","4":"1.3","5":"versicolor"},{"1":"6.1","2":"2.8","3":"4.7","4":"1.2","5":"versicolor"},{"1":"5.5","2":"2.4","3":"3.7","4":"1.0","5":"versicolor"},{"1":"5.8","2":"2.7","3":"5.1","4":"1.9","5":"virginica"},{"1":"6.4","2":"3.2","3":"4.5","4":"1.5","5":"versicolor"},{"1":"5.6","2":"2.7","3":"4.2","4":"1.3","5":"versicolor"},{"1":"5.8","2":"2.7","3":"4.1","4":"1.0","5":"versicolor"},{"1":"6.1","2":"2.8","3":"4.0","4":"1.3","5":"versicolor"},{"1":"6.7","2":"3.1","3":"5.6","4":"2.4","5":"virginica"},{"1":"6.3","2":"2.8","3":"5.1","4":"1.5","5":"virginica"},{"1":"6.3","2":"2.5","3":"5.0","4":"1.9","5":"virginica"},{"1":"5.7","2":"2.5","3":"5.0","4":"2.0","5":"virginica"},{"1":"6.2","2":"3.4","3":"5.4","4":"2.3","5":"virginica"},{"1":"6.4","2":"2.7","3":"5.3","4":"1.9","5":"virginica"},{"1":"6.3","2":"2.5","3":"4.9","4":"1.5","5":"versicolor"},{"1":"6.5","2":"3.0","3":"5.5","4":"1.8","5":"virginica"},{"1":"5.1","2":"2.5","3":"3.0","4":"1.1","5":"versicolor"},{"1":"5.7","2":"2.8","3":"4.1","4":"1.3","5":"versicolor"},{"1":"5.8","2":"2.8","3":"5.1","4":"2.4","5":"virginica"},{"1":"5.0","2":"2.0","3":"3.5","4":"1.0","5":"versicolor"},{"1":"5.6","2":"3.0","3":"4.5","4":"1.5","5":"versicolor"},{"1":"6.0","2":"3.4","3":"4.5","4":"1.6","5":"versicolor"},{"1":"6.0","2":"2.2","3":"4.0","4":"1.0","5":"versicolor"},{"1":"6.4","2":"3.2","3":"5.3","4":"2.3","5":"virginica"},{"1":"5.7","2":"2.9","3":"4.2","4":"1.3","5":"versicolor"},{"1":"6.2","2":"2.9","3":"4.3","4":"1.3","5":"versicolor"},{"1":"7.2","2":"3.2","3":"6.0","4":"1.8","5":"virginica"},{"1":"6.0","2":"2.9","3":"4.5","4":"1.5","5":"versicolor"},{"1":"4.9","2":"2.5","3":"4.5","4":"1.7","5":"virginica"},{"1":"6.5","2":"3.0","3":"5.8","4":"2.2","5":"virginica"},{"1":"6.2","2":"2.8","3":"4.8","4":"1.8","5":"virginica"},{"1":"6.9","2":"3.2","3":"5.7","4":"2.3","5":"virginica"},{"1":"5.9","2":"3.0","3":"4.2","4":"1.5","5":"versicolor"},{"1":"6.7","2":"3.1","3":"4.4","4":"1.4","5":"versicolor"},{"1":"5.8","2":"2.7","3":"5.1","4":"1.9","5":"virginica"},{"1":"7.2","2":"3.0","3":"5.8","4":"1.6","5":"virginica"},{"1":"6.4","2":"3.1","3":"5.5","4":"1.8","5":"virginica"},{"1":"5.7","2":"3.0","3":"4.2","4":"1.2","5":"versicolor"},{"1":"6.8","2":"3.0","3":"5.5","4":"2.1","5":"virginica"},{"1":"6.6","2":"2.9","3":"4.6","4":"1.3","5":"versicolor"},{"1":"6.0","2":"3.0","3":"4.8","4":"1.8","5":"virginica"},{"1":"6.2","2":"2.2","3":"4.5","4":"1.5","5":"versicolor"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>testing</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Sepal.Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sepal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Petal.Length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Petal.Width"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Species"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"6.9","2":"3.1","3":"4.9","4":"1.5","5":"versicolor"},{"1":"5.5","2":"2.3","3":"4.0","4":"1.3","5":"versicolor"},{"1":"6.5","2":"2.8","3":"4.6","4":"1.5","5":"versicolor"},{"1":"4.9","2":"2.4","3":"3.3","4":"1.0","5":"versicolor"},{"1":"5.2","2":"2.7","3":"3.9","4":"1.4","5":"versicolor"},{"1":"5.6","2":"2.9","3":"3.6","4":"1.3","5":"versicolor"},{"1":"6.6","2":"3.0","3":"4.4","4":"1.4","5":"versicolor"},{"1":"6.8","2":"2.8","3":"4.8","4":"1.4","5":"versicolor"},{"1":"5.7","2":"2.6","3":"3.5","4":"1.0","5":"versicolor"},{"1":"5.5","2":"2.4","3":"3.8","4":"1.1","5":"versicolor"},{"1":"5.5","2":"2.6","3":"4.4","4":"1.2","5":"versicolor"},{"1":"7.1","2":"3.0","3":"5.9","4":"2.1","5":"virginica"},{"1":"7.6","2":"3.0","3":"6.6","4":"2.1","5":"virginica"},{"1":"7.3","2":"2.9","3":"6.3","4":"1.8","5":"virginica"},{"1":"7.2","2":"3.6","3":"6.1","4":"2.5","5":"virginica"},{"1":"6.5","2":"3.2","3":"5.1","4":"2.0","5":"virginica"},{"1":"6.1","2":"3.0","3":"4.9","4":"1.8","5":"virginica"},{"1":"7.4","2":"2.8","3":"6.1","4":"1.9","5":"virginica"},{"1":"6.8","2":"3.2","3":"5.9","4":"2.3","5":"virginica"},{"1":"6.7","2":"3.3","3":"5.7","4":"2.5","5":"virginica"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<a href="#fnref6" class="footnote-back">↩︎</a></li>
<li id="fn7"><div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rf_classifier</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  randomForest(formula = Species ~ ., data = training) </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                Type of random forest: classification</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                      Number of trees: 500</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="do">## No. of variables tried at each split: 2</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="do">##         OOB estimate of  error rate: 11.25%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Confusion matrix:</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">##            versicolor virginica class.error</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="do">## versicolor         35         4   0.1025641</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="do">## virginica           5        36   0.1219512</span></span></code></pre></div>
<a href="#fnref7" class="footnote-back">↩︎</a></li>
<li id="fn8"><p><code>-ncol(testing)</code> means to drop the last column, so <code>testing[, -ncol(testing)</code> only contains features<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p><code>testing[[ncol(testing)]]</code> gets the last column, i.e, the real value of <code>Species</code> in the testing set<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> testing[[<span class="fu">ncol</span>(testing)]] <span class="sc">%&gt;%</span> {. <span class="sc">==</span>  <span class="st">&#39;versicolor&#39;</span>} <span class="sc">%&gt;%</span> as.integer</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(probability[, <span class="dv">1</span>], label)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>prediction <span class="sc">%&gt;%</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(<span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>) <span class="sc">%&gt;%</span> ROCR<span class="sc">::</span><span class="fu">plot</span>(<span class="at">main =</span> <span class="st">&quot;ROC Curve&quot;</span>) </span></code></pre></div>
<p><code>ROCR::prediction()</code> needs two arguments:</p>
<ul>
<li>the probability of a set of samples belonging to a given class (<code>versicolor</code> here)</li>
<li>the real classes of those samples, <code>1</code> means belonging the given class, <code>0</code> otherwise</li>
</ul>
<a href="#fnref10" class="footnote-back">↩︎</a></li>
</ol>
</div>
